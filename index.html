<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡è—å¾©èˆˆç•«å®¶çŒœè¬éŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #8B4513, #D2691E, #F4A460);
            min-height: 100vh;
            padding: 20px;
            color: #2F1B14;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 248, 220, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 3px solid #8B4513;
        }

        h1 {
            text-align: center;
            color: #8B4513;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            font-weight: bold;
        }

        .game-area {
            text-align: center;
        }

        .painting-container {
            margin-bottom: 30px;
            position: relative;
        }

        .painting {
            max-width: 400px;
            max-height: 400px;
            width: 100%;
            height: auto;
            border: 8px solid #8B4513;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
            display: block;
            margin: 0 auto;
        }

        .painting:hover {
            transform: scale(1.02);
        }

        .painting-title {
            font-size: 1.3em;
            color: #8B4513;
            margin-top: 15px;
            font-style: italic;
            font-weight: bold;
        }

        .question {
            font-size: 1.4em;
            margin: 20px 0;
            color: #2F1B14;
            font-weight: bold;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 30px 0;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .option {
            background: linear-gradient(145deg, #F5DEB3, #DEB887);
            border: 3px solid #8B4513;
            border-radius: 12px;
            padding: 15px 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #2F1B14;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }

        .option:hover {
            background: linear-gradient(145deg, #DEB887, #CD853F);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .option:active {
            transform: translateY(0);
        }

        .option.correct {
            background: linear-gradient(145deg, #90EE90, #32CD32);
            border-color: #228B22;
            animation: correctAnswer 0.6s ease;
        }

        .option.incorrect {
            background: linear-gradient(145deg, #FFB6C1, #FF6347);
            border-color: #DC143C;
            animation: incorrectAnswer 0.6s ease;
        }

        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectAnswer {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        .score-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: #8B4513;
        }

        .next-btn, .start-btn {
            background: linear-gradient(145deg, #CD853F, #8B4513);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .next-btn:hover, .start-btn:hover {
            background: linear-gradient(145deg, #8B4513, #654321);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .final-score {
            text-align: center;
            font-size: 2em;
            color: #8B4513;
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            border: 2px solid #DAA520;
        }

        .name-input-container {
            margin: 20px 0;
            text-align: center;
        }

        .name-input {
            background: rgba(255, 248, 220, 0.9);
            border: 2px solid #8B4513;
            border-radius: 10px;
            padding: 15px;
            font-size: 1.2em;
            color: #2F1B14;
            text-align: center;
            width: 300px;
            max-width: 90%;
        }

        .name-input:focus {
            outline: none;
            border-color: #CD853F;
            box-shadow: 0 0 10px rgba(205, 133, 63, 0.3);
        }

        .submit-score-btn {
            background: linear-gradient(145deg, #DAA520, #B8860B);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .submit-score-btn:hover {
            background: linear-gradient(145deg, #B8860B, #9A7B0A);
            transform: translateY(-2px);
        }

        .leaderboard {
            background: rgba(255, 248, 220, 0.9);
            border: 2px solid #8B4513;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .leaderboard h3 {
            text-align: center;
            color: #8B4513;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #DEB887;
        }

        .leaderboard-entry:last-child {
            border-bottom: none;
        }

        .leaderboard-rank {
            font-weight: bold;
            color: #8B4513;
            min-width: 30px;
        }

        .leaderboard-name {
            flex: 1;
            color: #2F1B14;
            margin: 0 15px;
        }

        .leaderboard-score {
            font-weight: bold;
            color: #CD853F;
        }

        .new-record {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            animation: newRecordGlow 1s ease-in-out infinite alternate;
        }

        @keyframes newRecordGlow {
            from { background: rgba(255, 215, 0, 0.3); }
            to { background: rgba(255, 215, 0, 0.6); }
        }

        .view-leaderboard-btn {
            background: linear-gradient(145deg, #8B4513, #654321);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .view-leaderboard-btn:hover {
            background: linear-gradient(145deg, #654321, #5D4E37);
            transform: translateY(-2px);
        }

        .intro {
            text-align: center;
            font-size: 1.3em;
            color: #2F1B14;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .loading {
            text-align: center;
            font-size: 1.2em;
            color: #8B4513;
            margin: 20px 0;
        }

        .explanation {
            background: rgba(255, 248, 220, 0.9);
            border: 2px solid #8B4513;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-size: 1.1em;
            line-height: 1.6;
            color: #2F1B14;
            text-align: left;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .explanation h4 {
            color: #8B4513;
            margin-bottom: 10px;
            font-size: 1.3em;
            text-align: center;
        }

        .explanation-content {
            text-indent: 2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ æ–‡è—å¾©èˆˆç•«å®¶çŒœè¬éŠæˆ² ğŸ¨</h1>
        
        <div id="intro-screen" class="intro">
            <p>æ­¡è¿ä¾†åˆ°æ–‡è—å¾©èˆˆè—è¡“ä¸–ç•Œï¼</p>
            <p>è§€å¯Ÿç•«ä½œï¼ŒçŒœæ¸¬ç•«å®¶æ˜¯èª°ã€‚</p>
            <p>å…±æœ‰ 5 é¡Œï¼Œæ¯é¡Œç­”å°å¾— 20 åˆ†ï¼</p>
            <button class="start-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
            <button class="view-leaderboard-btn" onclick="showLeaderboard()">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
        </div>

        <div id="game-screen" class="game-area" style="display: none;">
            <div class="score-info">
                <span>é¡Œç›®: <span id="current-question">1</span>/5</span>
                <span>åˆ†æ•¸: <span id="current-score">0</span></span>
            </div>
            
            <div class="painting-container">
                <img id="painting" class="painting" src="" alt="æ–‡è—å¾©èˆˆç•«ä½œ">
                <div id="painting-title" class="painting-title"></div>
            </div>
            
            <div class="question">é€™å¹…ç•«æ˜¯å“ªä½ç•«å®¶çš„ä½œå“ï¼Ÿ</div>
            
            <div class="options" id="options">
                <!-- é¸é …æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
            
            <div id="explanation" class="explanation" style="display: none;">
                <h4>ğŸ“š ä½œå“ä»‹ç´¹</h4>
                <div id="explanation-content" class="explanation-content"></div>
            </div>
            
            <button id="next-btn" class="next-btn" style="display: none;" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
        </div>

        <div id="result-screen" class="game-area" style="display: none;">
            <div class="final-score">
                <h2>ğŸ† éŠæˆ²çµæŸï¼ ğŸ†</h2>
                <p>æ‚¨çš„æœ€çµ‚åˆ†æ•¸ï¼š<span id="final-score">0</span> / 100</p>
                <div id="grade"></div>
            </div>
            
            <div id="name-input-section" class="name-input-container" style="display: none;">
                <p style="color: #8B4513; font-weight: bold; margin-bottom: 15px;">
                    ğŸ‰ æ­å–œï¼æ‚¨çš„åˆ†æ•¸é€²å…¥å‰ååï¼
                </p>
                <input type="text" id="player-name" class="name-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„å¤§å" maxlength="20">
                <br>
                <button class="submit-score-btn" onclick="submitScore()">æäº¤åˆ†æ•¸</button>
                <button class="start-btn" onclick="skipSubmission()">ç•¥é</button>
            </div>
            
            <div id="leaderboard-section" style="display: none;">
                <div class="leaderboard">
                    <h3>ğŸ† æ’è¡Œæ¦œ - å‰åå</h3>
                    <div id="leaderboard-list"></div>
                </div>
            </div>
            
            <div id="result-buttons" style="display: none;">
                <button class="view-leaderboard-btn" onclick="toggleLeaderboard()">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
                <button class="start-btn" onclick="restartGame()">é‡æ–°é–‹å§‹</button>
            </div>
        </div>
        
        <div id="leaderboard-screen" class="game-area" style="display: none;">
            <div class="leaderboard">
                <h3>ğŸ† æ’è¡Œæ¦œ - å‰åå</h3>
                <div id="main-leaderboard-list"></div>
            </div>
            <button class="start-btn" onclick="backToMenu()">å›åˆ°ä¸»é¸å–®</button>
        </div>
    </div>

    <script>
        // æ–‡è—å¾©èˆˆç•«ä½œè³‡æ–™åº«
        const paintings = [
            {
                title: "è’™å¨œéº—è",
                image: "images/mona_lisa.jpg",
                artist: "æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿",
                options: ["æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿", "ç±³é–‹æœ—åŸºç¾…", "æ‹‰æ–çˆ¾", "æ³¢æåˆ‡åˆ©"],
                explanation: "ã€Šè’™å¨œéº—èã€‹å‰µä½œæ–¼1503-1519å¹´ï¼Œæ˜¯é”æ–‡è¥¿æœ€è‘—åçš„ä½œå“ã€‚ç•«ä¸­å¥³å­ç¥ç§˜çš„å¾®ç¬‘å’Œé”æ–‡è¥¿ç¨ç‰¹çš„æšˆå¡—æ³•(sfumato)æŠ€æ³•ï¼Œä½¿é€™å¹…ç•«æˆç‚ºä¸–ç•Œä¸Šæœ€è‘—åçš„è‚–åƒç•«ã€‚ç›®å‰æ”¶è—æ–¼æ³•åœ‹ç¾…æµ®å®®ã€‚"
            },
            {
                title: "æœ€å¾Œçš„æ™šé¤",
                image: "images/last_supper.jpg",
                artist: "æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿",
                options: ["ç±³é–‹æœ—åŸºç¾…", "æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿", "æ‹‰æ–çˆ¾", "æé¦™"],
                explanation: "ã€Šæœ€å¾Œçš„æ™šé¤ã€‹å‰µä½œæ–¼1495-1498å¹´ï¼Œæç¹ªäº†è€¶ç©Œå‘Šè¨´é–€å¾’ä¸­æœ‰äººè¦èƒŒå›ä»–çš„å ´æ™¯ã€‚é”æ–‡è¥¿é‹ç”¨ç·šæ€§é€è¦–æ³•å’Œå¿ƒç†æç¹ªï¼Œå±•ç¾äº†æ¯ä½é–€å¾’ä¸åŒçš„åæ‡‰ã€‚é€™å¹…å£ç•«ä½æ–¼ç¾©å¤§åˆ©ç±³è˜­çš„è–ç‘ªåˆ©äºä¿®é“é™¢ã€‚"
            },
            {
                title: "å‰µä¸–ç´€ï¼ˆå‰µé€ äºç•¶ï¼‰",
                image: "images/creation_of_adam.jpg",
                artist: "ç±³é–‹æœ—åŸºç¾…",
                options: ["æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿", "ç±³é–‹æœ—åŸºç¾…", "æ‹‰æ–çˆ¾", "å¡æ‹‰ç“¦å–¬"],
                explanation: "ã€Šå‰µé€ äºç•¶ã€‹æ˜¯ç±³é–‹æœ—åŸºç¾…åœ¨è¥¿æ–¯æ±€æ•™å ‚å¤©èŠ±æ¿ä¸Šç¹ªè£½çš„å£ç•«ä¹‹ä¸€ï¼ˆ1508-1512å¹´ï¼‰ã€‚ç•«é¢ä¸­ä¸Šå¸èˆ‡äºç•¶çš„æ‰‹æŒ‡å³å°‡è§¸ç¢°çš„ç¶“å…¸å ´æ™¯ï¼Œè±¡å¾µäº†ç”Ÿå‘½çš„å‰µé€ ã€‚ç±³é–‹æœ—åŸºç¾…ä»¥ç²¾æ¹›çš„äººé«”è§£å‰–å­¸çŸ¥è­˜ï¼Œå‰µé€ äº†æ–‡è—å¾©èˆˆè—è¡“çš„å·”å³°ä¹‹ä½œã€‚"
            },
            {
                title: "é›…å…¸å­¸é™¢",
                image: "images/school_of_athens.jpg",
                artist: "æ‹‰æ–çˆ¾",
                options: ["æ‹‰æ–çˆ¾", "ç±³é–‹æœ—åŸºç¾…", "æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿", "ä¸æ‰˜åˆ—æ‰˜"],
                explanation: "ã€Šé›…å…¸å­¸é™¢ã€‹å‰µä½œæ–¼1509-1511å¹´ï¼Œæ˜¯æ‹‰æ–çˆ¾åœ¨æ¢µè’‚å²¡æ•™çš‡å®®ç¹ªè£½çš„å£ç•«ã€‚ç•«ä¸­åŒ¯é›†äº†å¤å¸Œè‡˜çš„å“²å­¸å®¶å’Œå­¸è€…ï¼Œä¸­å¤®æ˜¯æŸæ‹‰åœ–å’Œäºé‡Œæ–¯å¤šå¾·ã€‚é€™å¹…ä½œå“å®Œç¾é«”ç¾äº†æ–‡è—å¾©èˆˆæ™‚æœŸå°å¤å…¸å­¸è¡“çš„æ¨å´‡å’Œäººæ–‡ä¸»ç¾©ç²¾ç¥ã€‚"
            },
            {
                title: "ç¶­ç´æ–¯çš„èª•ç”Ÿ",
                image: "images/birth_of_venus.jpg",
                artist: "æ³¢æåˆ‡åˆ©",
                options: ["æ³¢æåˆ‡åˆ©", "æ‹‰æ–çˆ¾", "æé¦™", "æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿"],
                explanation: "ã€Šç¶­ç´æ–¯çš„èª•ç”Ÿã€‹å‰µä½œæ–¼1484-1486å¹´ï¼Œæç¹ªäº†ç¾…é¦¬ç¥è©±ä¸­æ„›èˆ‡ç¾çš„å¥³ç¥ç¶­ç´æ–¯å¾æµ·ä¸­èª•ç”Ÿçš„å ´æ™¯ã€‚æ³¢æåˆ‡åˆ©é‹ç”¨ç·šæ¢çš„å„ªç¾å’Œè‰²å½©çš„å’Œè«§ï¼Œå‰µé€ äº†ç†æƒ³åŒ–çš„ç¾ã€‚é€™å¹…ç•«ç¾æ”¶è—æ–¼ä½›ç¾…å€«æ–¯çš„çƒè²èŒ²ç¾è¡“é¤¨ã€‚"
            },
            {
                title: "æŠ±éŠ€é¼ çš„å¥³å­",
                image: "images/lady_with_ermine.jpg",
                artist: "æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿",
                options: ["ç±³é–‹æœ—åŸºç¾…", "æ‹‰æ–çˆ¾", "æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿", "æ³¢æåˆ‡åˆ©"],
                explanation: "ã€ŠæŠ±éŠ€é¼ çš„å¥³å­ã€‹å‰µä½œæ–¼1489-1491å¹´ï¼Œæç¹ªçš„æ˜¯ç±³è˜­å…¬çˆµç›§å¤šç¶­ç§‘çš„æƒ…å©¦åˆ‡å¥‡è‰äºÂ·åŠ èŠæ‹‰å°¼ã€‚é”æ–‡è¥¿ç²¾æ¹›åœ°æç¹ªäº†å¥³å­èˆ‡éŠ€é¼ çš„äº’å‹•ï¼Œå±•ç¾äº†ä»–å°å‹•ç‰©ç¿’æ€§çš„æ·±å…¥è§€å¯Ÿå’Œå“è¶Šçš„ç¹ªç•«æŠ€å·§ã€‚"
            },
            {
                title: "æ˜¥",
                image: "images/primavera.jpg",
                artist: "æ³¢æåˆ‡åˆ©",
                options: ["æ³¢æåˆ‡åˆ©", "æ‹‰æ–çˆ¾", "æé¦™", "ç±³é–‹æœ—åŸºç¾…"],
                explanation: "ã€Šæ˜¥ã€‹å‰µä½œæ–¼1477-1482å¹´ï¼Œæ˜¯æ³¢æåˆ‡åˆ©çš„ä»£è¡¨ä½œä¹‹ä¸€ã€‚ç•«ä¸­æç¹ªäº†ç¾…é¦¬ç¥è©±ä¸­çš„æ˜¥å¤©å¥³ç¥å’Œçœ¾ç¥çš„å ´æ™¯ï¼Œé«”ç¾äº†æ–°æŸæ‹‰åœ–ä¸»ç¾©å°ç¾å’Œæ„›çš„ç†æƒ³åŒ–è¿½æ±‚ã€‚ä½œå“å……æ»¿äº†è±¡å¾µæ„ç¾©å’Œè©©æ„çš„ç¾æ„Ÿã€‚"
            },
            {
                title: "è¥¿æ–¯æ±€è–æ¯",
                image: "images/sistine_madonna.jpg",
                artist: "æ‹‰æ–çˆ¾",
                options: ["æ‹‰æ–çˆ¾", "ç±³é–‹æœ—åŸºç¾…", "æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿", "æ³¢æåˆ‡åˆ©"],
                explanation: "ã€Šè¥¿æ–¯æ±€è–æ¯ã€‹å‰µä½œæ–¼1512å¹´ï¼Œæ˜¯æ‹‰æ–çˆ¾è–æ¯ç•«çš„å‚‘ä½œä¹‹ä¸€ã€‚ç•«ä¸­è–æ¯æŠ±è‘—è–å¬°ï¼Œå…©å´æ˜¯è–è¥¿æ–¯ç¯¤å’Œè–èŠ­èŠ­æ‹‰ï¼Œä¸‹æ–¹æ˜¯å…©å€‹å¯æ„›çš„å¤©ä½¿ã€‚æ‹‰æ–çˆ¾ä»¥æº«å’Œçš„è‰²èª¿å’Œå„ªç¾çš„æ§‹åœ–ï¼Œå±•ç¾äº†å®—æ•™è—è¡“çš„å´‡é«˜ä¹‹ç¾ã€‚"
            },
            {
                title: "å¤§è¡›åƒ",
                image: "images/david.jpg",
                artist: "ç±³é–‹æœ—åŸºç¾…",
                options: ["æå¥§ç´å¤šÂ·é”Â·æ–‡è¥¿", "ç±³é–‹æœ—åŸºç¾…", "æ‹‰æ–çˆ¾", "å¤šç´æ³°ç¾…"],
                explanation: "ã€Šå¤§è¡›åƒã€‹å‰µä½œæ–¼1501-1504å¹´ï¼Œæ˜¯ç±³é–‹æœ—åŸºç¾…çš„é›•å¡‘å‚‘ä½œã€‚é€™åº§é«˜é”5.17å…¬å°ºçš„å¤§ç†çŸ³é›•åƒæç¹ªäº†è–ç¶“ä¸­çš„è‹±é›„å¤§è¡›æº–å‚™è¿æˆ°å·¨äººæ­Œåˆ©äºçš„ç¬é–“ã€‚ç±³é–‹æœ—åŸºç¾…ç²¾æ¹›çš„è§£å‰–å­¸çŸ¥è­˜å’Œé›•åˆ»æŠ€è—ï¼Œä½¿é€™åº§é›•åƒæˆç‚ºæ–‡è—å¾©èˆˆè—è¡“çš„è±¡å¾µã€‚"
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let gameQuestions = [];
        let answered = false;
        let playerName = '';

        // æ’è¡Œæ¦œç®¡ç†
        class LeaderboardManager {
            constructor() {
                this.storageKey = 'renaissanceQuizLeaderboard';
                this.maxEntries = 10;
            }

            getLeaderboard() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('è®€å–æ’è¡Œæ¦œå¤±æ•—:', error);
                    return [];
                }
            }

            saveLeaderboard(leaderboard) {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(leaderboard));
                    return true;
                } catch (error) {
                    console.error('å„²å­˜æ’è¡Œæ¦œå¤±æ•—:', error);
                    return false;
                }
            }

            isTopScore(newScore) {
                const leaderboard = this.getLeaderboard();
                if (leaderboard.length < this.maxEntries) {
                    return true;
                }
                return newScore > leaderboard[leaderboard.length - 1].score;
            }

            addScore(name, score) {
                const leaderboard = this.getLeaderboard();
                
                // æ·»åŠ æ–°åˆ†æ•¸
                leaderboard.push({
                    name: name.trim() || 'åŒ¿åç©å®¶',
                    score: score,
                    date: new Date().toLocaleDateString('zh-TW')
                });

                // æ’åºï¼ˆåˆ†æ•¸é«˜åˆ°ä½ï¼‰
                leaderboard.sort((a, b) => b.score - a.score);

                // ä¿æŒå‰åå
                const topTen = leaderboard.slice(0, this.maxEntries);
                
                this.saveLeaderboard(topTen);
                
                // è¿”å›æ–°åˆ†æ•¸çš„æ’å
                return topTen.findIndex(entry => 
                    entry.name === (name.trim() || 'åŒ¿åç©å®¶') && 
                    entry.score === score
                ) + 1;
            }

            renderLeaderboard(containerId, highlightScore = null) {
                const container = document.getElementById(containerId);
                const leaderboard = this.getLeaderboard();
                
                if (leaderboard.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #8B4513;">æš«ç„¡è¨˜éŒ„ï¼Œå¿«ä¾†æŒ‘æˆ°å§ï¼</p>';
                    return;
                }

                let html = '';
                leaderboard.forEach((entry, index) => {
                    const isNewRecord = highlightScore && entry.score === highlightScore;
                    const rankEmoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ…';
                    
                    html += `
                        <div class="leaderboard-entry ${isNewRecord ? 'new-record' : ''}">
                            <span class="leaderboard-rank">${rankEmoji} ${index + 1}</span>
                            <span class="leaderboard-name">${entry.name}</span>
                            <span class="leaderboard-score">${entry.score} åˆ†</span>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            clearLeaderboard() {
                if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ’è¡Œæ¦œè¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                    localStorage.removeItem(this.storageKey);
                    alert('æ’è¡Œæ¦œå·²æ¸…é™¤ï¼');
                    return true;
                }
                return false;
            }
        }

        const leaderboard = new LeaderboardManager();

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startGame() {
            // éš¨æ©Ÿé¸æ“‡5é“é¡Œç›®
            gameQuestions = shuffleArray(paintings).slice(0, 5);
            currentQuestionIndex = 0;
            score = 0;
            
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('leaderboard-screen').style.display = 'none';
            
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= gameQuestions.length) {
                showResults();
                return;
            }

            answered = false;
            const question = gameQuestions[currentQuestionIndex];
            
            // æ›´æ–°é¡Œç›®è³‡è¨Š
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('current-score').textContent = score;
            
            // æ¸…ç†ä¹‹å‰çš„åœ–ç‰‡å®¹å™¨
            const container = document.querySelector('.painting-container');
            const existingPlaceholder = container.querySelector('.image-placeholder');
            if (existingPlaceholder) {
                existingPlaceholder.remove();
            }
            
            // è¨­ç½®ç•«ä½œ
            const paintingImg = document.getElementById('painting');
            paintingImg.style.display = 'block'; // ç¢ºä¿åœ–ç‰‡é¡¯ç¤º
            paintingImg.src = question.image;
            
            paintingImg.onerror = function() {
                // å¦‚æœåœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼Œå‰µå»ºä¸€å€‹ç¾è§€çš„æ›¿ä»£é¡¯ç¤º
                this.style.display = 'none';
                const container = this.parentElement;
                
                // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰æ›¿ä»£å…ƒç´ 
                let placeholder = container.querySelector('.image-placeholder');
                if (!placeholder) {
                    placeholder = document.createElement('div');
                    placeholder.className = 'image-placeholder';
                    placeholder.style.cssText = `
                        width: 400px;
                        height: 300px;
                        background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
                        border: 8px solid #8B4513;
                        border-radius: 10px;
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                        align-items: center;
                        margin: 0 auto;
                        color: #8B4513;
                        font-size: 1.2em;
                        text-align: center;
                        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
                    `;
                    placeholder.innerHTML = `
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ¨</div>
                        <div style="font-weight: bold;">${question.title}</div>
                        <div style="font-size: 0.9em; margin-top: 5px; color: #666;">åœ–ç‰‡è¼‰å…¥ä¸­...</div>
                    `;
                    container.insertBefore(placeholder, this);
                }
            };
            
            document.getElementById('painting-title').textContent = question.title;
            
            // ç”Ÿæˆé¸é …
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            // éš¨æ©Ÿæ’åˆ—é¸é …
            const shuffledOptions = shuffleArray(question.options);
            
            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option';
                button.textContent = option;
                button.onclick = () => selectAnswer(option, question.artist);
                optionsContainer.appendChild(button);
            });
            
            // éš±è—èªªæ˜å’Œä¸‹ä¸€é¡ŒæŒ‰éˆ•
            document.getElementById('explanation').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
        }

        function selectAnswer(selectedOption, correctAnswer) {
            if (answered) return;
            answered = true;
            
            const question = gameQuestions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            options.forEach(option => {
                if (option.textContent === correctAnswer) {
                    option.classList.add('correct');
                } else if (option.textContent === selectedOption && selectedOption !== correctAnswer) {
                    option.classList.add('incorrect');
                }
                option.style.pointerEvents = 'none';
            });
            
            if (selectedOption === correctAnswer) {
                score += 20;
                document.getElementById('current-score').textContent = score;
            }
            
            // é¡¯ç¤ºä½œå“èªªæ˜
            setTimeout(() => {
                const explanationDiv = document.getElementById('explanation');
                const explanationContent = document.getElementById('explanation-content');
                
                if (explanationDiv && explanationContent && question.explanation) {
                    explanationContent.textContent = question.explanation;
                    explanationDiv.style.display = 'block';
                    
                    // å¹³æ»‘æ»¾å‹•åˆ°èªªæ˜å€åŸŸ
                    explanationDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                
                document.getElementById('next-btn').style.display = 'block';
            }, 1500);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function showResults() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-score').textContent = score;
            
            const gradeElement = document.getElementById('grade');
            let grade = '';
            let emoji = '';
            
            if (score === 100) {
                grade = 'å®Œç¾ï¼æ‚¨æ˜¯æ–‡è—å¾©èˆˆå°ˆå®¶ï¼';
                emoji = 'ğŸŒŸ';
            } else if (score >= 80) {
                grade = 'å„ªç§€ï¼æ‚¨å°æ–‡è—å¾©èˆˆå¾ˆäº†è§£ï¼';
                emoji = 'ğŸ¨';
            } else if (score >= 60) {
                grade = 'ä¸éŒ¯ï¼ç¹¼çºŒå­¸ç¿’æ–‡è—å¾©èˆˆè—è¡“ï¼';
                emoji = 'ğŸ“š';
            } else if (score >= 40) {
                grade = 'é‚„å¯ä»¥ï¼å¤šçœ‹çœ‹æ–‡è—å¾©èˆˆç•«ä½œå§ï¼';
                emoji = 'ğŸ¤”';
            } else {
                grade = 'åŠ æ²¹ï¼æ–‡è—å¾©èˆˆè—è¡“ç­‰æ‚¨æ¢ç´¢ï¼';
                emoji = 'ğŸ’ª';
            }
            
            gradeElement.innerHTML = `<h3>${emoji} ${grade} ${emoji}</h3>`;
            
            // æª¢æŸ¥æ˜¯å¦é€²å…¥æ’è¡Œæ¦œ
            if (leaderboard.isTopScore(score)) {
                document.getElementById('name-input-section').style.display = 'block';
                document.getElementById('result-buttons').style.display = 'none';
                document.getElementById('player-name').focus();
            } else {
                document.getElementById('name-input-section').style.display = 'none';
                document.getElementById('result-buttons').style.display = 'block';
            }
        }

        function submitScore() {
            const nameInput = document.getElementById('player-name');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('è«‹è¼¸å…¥æ‚¨çš„å¤§åï¼');
                nameInput.focus();
                return;
            }
            
            if (name.length > 20) {
                alert('åå­—ä¸èƒ½è¶…é20å€‹å­—ç¬¦ï¼');
                nameInput.focus();
                return;
            }
            
            // æ·»åŠ åˆ°æ’è¡Œæ¦œ
            const rank = leaderboard.addScore(name, score);
            
            // é¡¯ç¤ºçµæœ
            document.getElementById('name-input-section').style.display = 'none';
            document.getElementById('leaderboard-section').style.display = 'block';
            document.getElementById('result-buttons').style.display = 'block';
            
            // æ¸²æŸ“æ’è¡Œæ¦œä¸¦é«˜äº®æ–°åˆ†æ•¸
            leaderboard.renderLeaderboard('leaderboard-list', score);
            
            // é¡¯ç¤ºæ­å–œè¨Šæ¯
            setTimeout(() => {
                alert(`æ­å–œï¼æ‚¨ç²å¾—ç¬¬ ${rank} åï¼`);
            }, 500);
        }

        function skipSubmission() {
            document.getElementById('name-input-section').style.display = 'none';
            document.getElementById('result-buttons').style.display = 'block';
        }

        function toggleLeaderboard() {
            const leaderboardSection = document.getElementById('leaderboard-section');
            if (leaderboardSection.style.display === 'none') {
                leaderboardSection.style.display = 'block';
                leaderboard.renderLeaderboard('leaderboard-list');
            } else {
                leaderboardSection.style.display = 'none';
            }
        }

        function showLeaderboard() {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('leaderboard-screen').style.display = 'block';
            leaderboard.renderLeaderboard('main-leaderboard-list');
        }

        function backToMenu() {
            document.getElementById('leaderboard-screen').style.display = 'none';
            document.getElementById('intro-screen').style.display = 'block';
        }

        function restartGame() {
            // é‡ç½®é¡¯ç¤ºç‹€æ…‹
            document.getElementById('leaderboard-section').style.display = 'none';
            startGame();
        }

        // ç›£è½ Enter éµæäº¤åˆ†æ•¸
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('player-name');
            if (nameInput) {
                nameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        submitScore();
                    }
                });
            }
        });

        // ç¢ºä¿åœ–ç‰‡æ­£ç¢ºè¼‰å…¥
        window.addEventListener('load', function() {
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.addEventListener('error', function() {
                    console.log('åœ–ç‰‡è¼‰å…¥å¤±æ•—:', this.src);
                });
            });
        });
    </script>
</body>
</html>
